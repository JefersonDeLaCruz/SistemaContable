<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Usuarios</title>
</head>
<body>
    <div>
        <h1>Gestión de Usuarios</h1>
        <div>
            <span>Admin: <strong th:text="${usuario.username}">Usuario</strong></span>
            <span>ADMIN</span>
            <a href="/logout">Cerrar Sesión</a>
        </div>
    </div>

    <div>
        <div>
            <a href="/dashboard">← Volver al Dashboard</a>
        </div>

        <div>
            <h2>Administración de Usuarios del Sistema</h2>
            <p>Gestión completa de usuarios: crear, editar, activar/desactivar y eliminar usuarios.</p>
            
            <div>
                <h3>Acciones</h3>
                <div>
                    <a href="/admin/crear-usuario">Crear Nuevo Usuario</a>
                    <button type="button">Exportar Lista de Usuarios</button>
                </div>
            </div>

            <div>
                <h3>Filtros</h3>
                <form>
                    <div>
                        <label for="buscar-usuario">Buscar Usuario:</label>
                        <input type="text" id="buscar-usuario" name="buscarUsuario" placeholder="Nombre de usuario o email...">
                    </div>
                    <div>
                        <label for="filtro-rol">Filtrar por Rol:</label>
                        <select id="filtro-rol" name="filtroRol">
                            <option value="">Todos los roles</option>
                            <option value="ADMIN">Admin</option>
                            <option value="AUDITOR">Auditor</option>
                            <option value="CONTADOR">Contador</option>
                        </select>
                    </div>
                    <div>
                        <label for="filtro-estado">Estado:</label>
                        <select id="filtro-estado" name="filtroEstado">
                            <option value="">Todos</option>
                            <option value="true">Activos</option>
                            <option value="false">Inactivos</option>
                        </select>
                    </div>
                    <button type="submit">Filtrar</button>
                </form>
            </div>

            <div>
                <h3>Lista de Usuarios</h3>
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Usuario</th>
                            <th>Email</th>
                            <th>Rol</th>
                            <th>Estado</th>
                            <th>Creado</th>
                            <th>Última Actualización</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="u : ${usuarios}">
                            <td th:text="${u.id}">1</td>
                            <td th:text="${u.username}">usuario</td>
                            <td th:text="${u.email}">email@example.com</td>
                            <td>
                                <span th:text="${u.role}" th:class="${u.role == 'ADMIN' ? 'badge-admin' : u.role == 'AUDITOR' ? 'badge-auditor' : 'badge-contador'}">ADMIN</span>
                            </td>
                            <td>
                                <span th:text="${u.active ? 'Activo' : 'Inactivo'}" th:class="${u.active ? 'status-active' : 'status-inactive'}">Activo</span>
                            </td>
                            <td th:text="${u.createdAt}">2024-01-01</td>
                            <td th:text="${u.updatedAt}">2024-01-01</td>
                            <td>
                                <div>
                                    <button type="button" th:onclick="'editarUsuario(' + ${u.id} + ')'">Editar</button>
                                    <button type="button" th:onclick="'toggleUsuario(' + ${u.id} + ', ' + ${u.active} + ')'" 
                                            th:text="${u.active ? 'Desactivar' : 'Activar'}">Desactivar</button>
                                    <button type="button" th:onclick="'eliminarUsuario(' + ${u.id} + ')'" 
                                            th:if="${u.username != usuario.username}">Eliminar</button>
                                </div>
                            </td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(usuarios)}">
                            <td colspan="8">No hay usuarios registrados</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div>
                <h3>Estadísticas de Usuarios</h3>
                <div>
                    <div>
                        <h4>Por Rol</h4>
                        <ul>
                            <li>Administradores: <span th:text="${#lists.size(#lists.select(usuarios, u -> u.role == 'ADMIN'))}">0</span></li>
                            <li>Auditores: <span th:text="${#lists.size(#lists.select(usuarios, u -> u.role == 'AUDITOR'))}">0</span></li>
                            <li>Contadores: <span th:text="${#lists.size(#lists.select(usuarios, u -> u.role == 'CONTADOR'))}">0</span></li>
                        </ul>
                    </div>
                    <div>
                        <h4>Por Estado</h4>
                        <ul>
                            <li>Usuarios Activos: <span th:text="${#lists.size(#lists.select(usuarios, u -> u.active))}">0</span></li>
                            <li>Usuarios Inactivos: <span th:text="${#lists.size(#lists.select(usuarios, u -> !u.active))}">0</span></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function editarUsuario(id) {
            alert('Función de editar usuario ID: ' + id + ' - Por implementar');
        }
        
        function toggleUsuario(id, currentStatus) {
            const action = currentStatus ? 'desactivar' : 'activar';
            if (confirm('¿Está seguro de ' + action + ' este usuario?')) {
                alert('Función de ' + action + ' usuario ID: ' + id + ' - Por implementar');
            }
        }
        
        function eliminarUsuario(id) {
            if (confirm('¿Está seguro de eliminar este usuario? Esta acción no se puede deshacer.')) {
                alert('Función de eliminar usuario ID: ' + id + ' - Por implementar');
            }
        }
    </script>
</body>
</html>
