<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" data-theme="corporate">
<head th:replace="~{layout :: head}">
  <link rel="stylesheet" th:href="@{/css/output.css}"/>
  <link rel="stylesheet" th:href="@{/css/style.css}"/>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <title>Subir PDF</title>
</head>
<body>

<div class="drawer">
  <input id="my-drawer-3" type="checkbox" class="drawer-toggle" />

  <div class="drawer-content flex flex-col">
    <!-- Navbar -->
    <div class="navbar bg-base-300 w-full">
      <div class="flex-none">
        <label for="my-drawer-3" aria-label="open sidebar" class="btn btn-square btn-ghost">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block h-6 w-6 stroke-current">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </label>
      </div>
      <div class="mx-2 flex-1 px-2">Subir PDF</div>
      <div class="hidden flex-none lg:block">
        <ul class="menu menu-horizontal">
          <li><a>Perfil</a></li>
          <li><a>Configuración</a></li>
        </ul>
      </div>
    </div>

    <!-- Título -->
    <div class="px-6 pt-8">
      <h1 class="text-3xl font-bold mb-2">Adjuntar documentos</h1>
      <p class="text-base-content/70 mb-6">Sube documentos contables para vincular con partidas</p>
      <div class="divider w-2/3"></div>
    </div>

    <!-- Formulario -->
    <div class="px-6 pb-10">
      <form class="max-w-5xl"
            th:action="@{/contador/subir-pdf}"
            th:object="${upload}"
            method="post"
            enctype="multipart/form-data">

        <!-- Dropzone -->
        <div id="dropzone"
             class="border-2 border-dashed border-primary/30 rounded-xl p-12 mb-10 text-center bg-base-100 hover:bg-base-200 hover:border-primary/50 transition-all duration-200 cursor-pointer">
          <input id="fileInput" type="file" name="archivo" accept="application/pdf" class="hidden" required>
          <div class="mb-4">
            <svg class="w-16 h-16 mx-auto text-primary/50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
          </div>
          <p id="dzText" class="text-lg font-medium mb-2">Arrastra y suelta el archivo aquí</p>
          <p class="text-sm opacity-70 mb-4">o haz clic para seleccionar un archivo PDF</p>
          <p id="dzFile" class="text-sm font-medium text-success"></p>
        </div>

        <!-- Grid de campos -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-x-10 gap-y-6 max-w-3xl">

          <!-- Tipo de documento -->
          <div class="form-control md:col-span-1">
            <label class="label"><span class="label-text">Tipo de Documento</span></label>
            <select class="select select-bordered" th:field="*{tipoDocumento}" required>
              <option value="" disabled selected>Seleccionar...</option>
              <option th:each="t : ${tiposDocumento}" th:value="${t}" th:text="${t}">Factura</option>
            </select>
            <p class="text-error text-sm mt-1" th:if="${#fields.hasErrors('tipoDocumento')}" th:errors="*{tipoDocumento}"></p>
          </div>

          <!-- Número de documento -->
          <div class="form-control md:col-span-1">
            <label class="label"><span class="label-text">Número de Documento</span></label>
            <input type="text" class="input input-bordered" th:field="*{numeroDocumento}" placeholder="Ej: FAC-2025-001" required>
            <p class="text-error text-sm mt-1" th:if="${#fields.hasErrors('numeroDocumento')}" th:errors="*{numeroDocumento}"></p>
          </div>

          <!-- Proveedor -->
          <div class="form-control md:col-span-1">
            <label class="label"><span class="label-text">Proveedor</span></label>
            <input type="text" class="input input-bordered" th:field="*{proveedor}" placeholder="Nombre o razón social" required>
            <p class="text-error text-sm mt-1" th:if="${#fields.hasErrors('proveedor')}" th:errors="*{proveedor}"></p>
          </div>

          <!-- Fecha del documento -->
          <div class="form-control md:col-span-1">
            <label class="label"><span class="label-text">Fecha del Documento</span></label>
            <input type="date" class="input input-bordered" th:field="*{fechaDocumento}" required>
            <p class="text-error text-sm mt-1" th:if="${#fields.hasErrors('fechaDocumento')}" th:errors="*{fechaDocumento}"></p>
          </div>

          <!-- Monto -->
          <div class="form-control md:col-span-1">
            <label class="label"><span class="label-text">Monto</span></label>
            <input type="number" step="0.01" min="0" class="input input-bordered" th:field="*{monto}" placeholder="0.00" required>
            <p class="text-error text-sm mt-1" th:if="${#fields.hasErrors('monto')}" th:errors="*{monto}"></p>
          </div>

          <!-- Vincular a Partida -->
          <div class="form-control md:col-span-1">
            <label class="label"><span class="label-text">Vincular a Partida</span></label>
            <select class="select select-bordered" th:field="*{partidaId}">
              <option value="" selected>Seleccionar...</option>
              <option th:each="p : ${partidas}" th:value="${p.id}"
                      th:text="${'Partida #'+ p.id + ' — ' + (p.descripcion != null ? p.descripcion : '')}">
                Partida
              </option>
            </select>
            <p class="text-error text-sm mt-1" th:if="${#fields.hasErrors('partidaId')}" th:errors="*{partidaId}"></p>
          </div>
        </div>

        <!-- Acciones -->
        <div class="mt-10 flex gap-4 justify-end">
          <a th:href="@{/dashboard}" class="btn btn-ghost">Cancelar</a>
          <button type="submit" class="btn btn-primary">Subir Documento</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ASIDE-->
  <div class="drawer-side">
    <label for="my-drawer-3" aria-label="close sidebar" class="drawer-overlay"></label>
    <ul class="menu bg-base-200 min-h-full w-64 p-3 flex flex-col">
      <!-- Marca -->
      <li class="mb-2">
        <div class="px-2 py-3">
          <h1 class="text-2xl font-bold leading-tight">SIC</h1>
          <p class="text-xs opacity-70">Sistema Contable</p>
        </div>
      </li>

      <!-- Dashboard común -->
      <li>
        <a th:href="@{/dashboard}">Dashboard</a>
      </li>

      <!-- CONTADOR -->
      <div th:if="${usuario.role == 'CONTADOR'}" class="mt-2">
        <li class="menu-title"><span>Contabilidad</span></li>
        <li><a th:href="@{/registrar-partida}">Registrar Partida</a></li>
        <li><a th:href="@{/contador/libro-diario}">Libro Diario</a></li>
        <li><a th:href="@{/contador/libro-mayor}">Libro Mayor</a></li>
        <li><a th:href="@{/contador/balance-comprobacion}">Balance Comprobación</a></li>
        <li><a th:href="@{/contador/balance-general}">Balance General</a></li>
        <li class="active menu-active"><a th:href="@{/contador/subir-pdf}">Subir PDF</a></li>
        <li><a th:href="@{/contador/configuracion}">Configuración</a></li>
      </div>

      <div class="flex-1"></div>

      <li class="mt-2">
        <form th:action="@{/logout}" method="post">
          <button type="submit" class="btn btn-outline btn-error w-full">Cerrar sesión</button>
        </form>
      </li>
    </ul>
  </div>
</div>

</body>
</html>
